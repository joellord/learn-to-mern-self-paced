"use strict";(self.webpackChunkswiftui_realm_app=self.webpackChunkswiftui_realm_app||[]).push([[9960],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},g="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),g=s(n),d=o,m=g["".concat(p,".").concat(d)]||g[d]||c[d]||r;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[g]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9178:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=n(7462),o=(n(7294),n(3905));const r={},i="Aggregation Pipelines",l={unversionedId:"mongodb/aggregations",id:"mongodb/aggregations",title:"Aggregation Pipelines",description:"Sometimes, you need more that just a filter to query your data. You might want to perform some calculations on the data, or group the data in some way. This is where aggregation pipelines come in.",source:"@site/docs/6-mongodb/5-aggregations.mdx",sourceDirName:"6-mongodb",slug:"/mongodb/aggregations",permalink:"/learn-to-mern-self-paced/docs/mongodb/aggregations",draft:!1,editUrl:"https://github.com/mongodb-developer/learn-to-mern-self-paced/blob/main/docs/6-mongodb/5-aggregations.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Querying with code",permalink:"/learn-to-mern-self-paced/docs/mongodb/querying-in-code"},next:{title:"Get working!",permalink:"/learn-to-mern-self-paced/docs/mongodb/exercises"}},p={},s=[{value:"Aggregation Pipeline Stages",id:"aggregation-pipeline-stages",level:2},{value:"$match",id:"match",level:3},{value:"$project",id:"project",level:3},{value:"$sort",id:"sort",level:3},{value:"$limit",id:"limit",level:3},{value:"$group",id:"group",level:3},{value:"Building an Aggregation Pipeline",id:"building-an-aggregation-pipeline",level:2},{value:"Using aggregations in your code",id:"using-aggregations-in-your-code",level:2}],u={toc:s},g="wrapper";function c(e){let{components:t,...n}=e;return(0,o.kt)(g,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"aggregation-pipelines"},"Aggregation Pipelines"),(0,o.kt)("p",null,"Sometimes, you need more that just a filter to query your data. You might want to perform some calculations on the data, or group the data in some way. This is where aggregation pipelines come in."),(0,o.kt)("h2",{id:"aggregation-pipeline-stages"},"Aggregation Pipeline Stages"),(0,o.kt)("p",null,"Aggregation pipelines are a series of stages that are executed in order. Each stage takes the output of the previous stage and performs some operation on it. The output of the last stage is the result of the pipeline."),(0,o.kt)("h3",{id:"match"},"$match"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"$match")," stage is similar to the ",(0,o.kt)("inlineCode",{parentName:"p"},"find")," method. It filters the documents in the pipeline based on the given criteria."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'[\n  { $match: { title: "The Godfather" } }\n]\n')),(0,o.kt)("h3",{id:"project"},"$project"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"$project")," stage is similar to the ",(0,o.kt)("inlineCode",{parentName:"p"},"select")," method. It allows you to select which fields to include in the output."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"[\n  { $project: { title: 1, year: 1 } }\n]\n")),(0,o.kt)("h3",{id:"sort"},"$sort"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"$sort")," stage is similar to the ",(0,o.kt)("inlineCode",{parentName:"p"},"sort")," method. It allows you to sort the documents in the pipeline."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"[\n  { $sort: { year: -1 } }\n]\n")),(0,o.kt)("h3",{id:"limit"},"$limit"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"$limit")," stage will limit the number of documents in the pipeline."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"[\n  { $limit: 10 }\n]\n")),(0,o.kt)("h3",{id:"group"},"$group"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"$group")," stage will group the documents in the pipeline by the given criteria."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'[\n  { $group: { _id: "$year", count: { $sum: 1 } } }\n]\n')),(0,o.kt)("h2",{id:"building-an-aggregation-pipeline"},"Building an Aggregation Pipeline"),(0,o.kt)("p",null,"The easiest way to build your aggregation pipelines is through the Atlas UI (or Compass). You can use the aggregation pipeline builder to build your pipelines visually."),(0,o.kt)("p",null,"Let's build an aggregation pipelines that finds the country that produced the most movies in 2010."),(0,o.kt)("p",null,'Still in the movies collection, click on the "Aggregations" tab at the top.'),(0,o.kt)("p",null,"Our first stage will be a ",(0,o.kt)("inlineCode",{parentName:"p"},"$match"),' stage. We want to find all the movies from 2010. Click "Add Stage", select ',(0,o.kt)("inlineCode",{parentName:"p"},"$match")," from the dropdown, and enter the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"{ year: 2010 }\n")),(0,o.kt)("p",null,'You will see a random sample of 20 documents from the movies collection that match the criteria. Click "Add Stage" to move on to the next stage.'),(0,o.kt)("p",null,"Our next stage will be a ",(0,o.kt)("inlineCode",{parentName:"p"},"$unwind"),' stage. We want a document for each country that produced a movie in 2010. Click "Add Stage", select ',(0,o.kt)("inlineCode",{parentName:"p"},"$unwind")," from the dropdown, and enter the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'{ path: "$countries" }\n')),(0,o.kt)("p",null,"Next, we'll add a ",(0,o.kt)("inlineCode",{parentName:"p"},"$group"),' stage. We want to group the documents by country and count the number of movies produced by each country. Click "Add Stage", select ',(0,o.kt)("inlineCode",{parentName:"p"},"$group")," from the dropdown, and enter the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'{ _id: "$countries", count: { $sum: 1 } }\n')),(0,o.kt)("p",null,"Then, we'll add a ",(0,o.kt)("inlineCode",{parentName:"p"},"$sort"),' stage. We want to sort the documents by the count in descending order. Click "Add Stage", select ',(0,o.kt)("inlineCode",{parentName:"p"},"$sort")," from the dropdown, and enter the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"{ count: -1 }\n")),(0,o.kt)("p",null,"And finally, we'll add a ",(0,o.kt)("inlineCode",{parentName:"p"},"$limit"),' stage. We only want the top result. Click "Add Stage", select ',(0,o.kt)("inlineCode",{parentName:"p"},"$limit")," from the dropdown, and enter the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"1\n")),(0,o.kt)("p",null,"The output should be a single document with the country that produced the most movies in 2010."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "_id": "USA",\n  "count": 412\n}\n')),(0,o.kt)("h2",{id:"using-aggregations-in-your-code"},"Using aggregations in your code"),(0,o.kt)("p",null,'In the aggregation builder, you will also find a "Export To Language" button. From there, you\'ll be able to export your aggregation pipeline to the language of your choice. You can then copy and paste the code into your application.'))}c.isMDXComponent=!0}}]);